import{j as s,r as h,R as b}from"./index-b9ab5773.js";import{a as D,P as e,k as $,f as P,Q as C}from"./index-4b3d0e90.js";import{L}from"./Loader-926100a2.js";const T=async t=>{try{const{data:i}=await D.get(`/shop/${t}`);return i.data.shop}catch(i){console.log(i)}},A="_info_wrapper_1pkj5_1",B="_info_image_1pkj5_6",O={info_wrapper:A,info_image:B},v=()=>s.jsx("div",{className:O.info_wrapper,children:s.jsx("img",{src:"https://i.postimg.cc/4xjNmdXg/16697949609968.png",alt:"apologies"})}),E="_shopItem_kf758_2",J="_selected_kf758_30",F="_disabled_kf758_35",Q="_shopTitle_kf758_40",U="_shopAddress_kf758_46",f={shopItem:E,selected:J,disabled:F,shopTitle:Q,shopAddress:U},I=({id:t,name:i,address:a,selectedShopId:r,handleClick:d})=>{const n=()=>{d(t)};return s.jsxs("li",{className:`${f.shopItem} ${t===r?f.selected:""}`,onClick:n,children:[s.jsx("p",{className:f.shopTitle,children:i}),s.jsx("p",{className:f.shopAddress,children:a})]},t)};I.propTypes={id:e.string.isRequired,name:e.string.isRequired,address:e.string.isRequired,handleClick:e.func.isRequired,selectedShopId:e.string};const X="_shopList_1mpy0_2",z={shopList:X},R=({shops:t,handleClick:i,selectedShopId:a})=>s.jsx(s.Fragment,{children:s.jsx("ul",{className:z.shopList,children:t.map(({_id:r,name:d,address:n})=>s.jsx(I,{id:r,name:d,address:n,selectedShopId:a,handleClick:i},r))})});R.propTypes={shops:e.arrayOf(e.shape({_id:e.string.isRequired,name:e.string.isRequired,address:e.string.isRequired,dishes:e.array.isRequired})).isRequired,handleClick:e.func.isRequired,selectedShopId:e.string,isDisabled:e.bool};const G="_card_k3df6_1",H="_image_wrapper_k3df6_6",K="_image_k3df6_6",M="_title_k3df6_21",V="_price_k3df6_27",W="_addButton_k3df6_34",Y="_disabled_k3df6_48",g={card:G,image_wrapper:H,image:K,title:M,price:V,addButton:W,disabled:Y},N=({title:t,id:i,imageUrl:a,price:r,shopId:d,selectedShopId:n,isDisabled:c})=>{const[m,l]=h.useState(!1);h.useEffect(()=>{const u=(JSON.parse(localStorage.getItem("dishes"))||[]).findIndex(o=>o.id===i&&o.shopId===n);l(u!==-1)},[i,n]);const x=()=>{const _=JSON.parse(localStorage.getItem("dishes"))||[],u=_.findIndex(o=>o.id===i&&o.shopId===n);if(u!==-1)_.splice(u,1),l(!1);else{const o={id:i,title:t,imageUrl:a,price:r,shopId:n,isAdded:!0,quantity:1};_.push(o),l(!0)}localStorage.setItem("dishes",JSON.stringify(_))};return s.jsxs("div",{className:g.card,children:[s.jsx("div",{className:g.image_wrapper,children:s.jsx("img",{className:g.image,width:200,height:80,src:a,alt:"meal"})}),s.jsxs("div",{children:[s.jsx("p",{className:g.title,children:t}),s.jsxs("p",{className:g.price,children:["Price: ",r,"$"]})]}),s.jsx("button",{className:`${g.addButton} ${c?g.disabled:""}`,type:"button",onClick:x,disabled:c||d!==n,children:m?"Remove":"Add"})]},i)};N.propTypes={id:e.string.isRequired,title:e.string.isRequired,imageUrl:e.string.isRequired,shopId:e.string.isRequired,price:e.number.isRequired,selectedShopId:e.string,isDisabled:e.bool};const Z="_dishes_list_yaola_1",ss="_dishes_item_yaola_17",y={dishes_list:Z,dishes_item:ss},k=({dishes:t,selectedShopId:i,isDisabled:a})=>s.jsx("ul",{className:y.dishes_list,children:t.map(({title:r,_id:d,imageUrl:n,price:c,id:m,shopId:l})=>s.jsx("li",{className:y.dishes_item,children:s.jsx(N,{title:r,id:m,imageUrl:n,price:c,shopId:l,selectedShopId:i,isDisabled:a})},d))});k.propTypes={dishes:e.arrayOf(e.shape({_id:e.string.isRequired,title:e.string.isRequired,imageUrl:e.string.isRequired,price:e.number.isRequired})).isRequired,selectedShopId:e.string,isDisabled:e.bool};const es=(t,i)=>t.map(a=>({...a,shopId:i})),ts="_page_container_36ai3_1",is="_content_wrapper_36ai3_7",as="_shopPage_title_36ai3_12",S={page_container:ts,content_wrapper:is,shopPage_title:as},os=b.memo(()=>{const[t,i]=h.useState(null),[a,r]=h.useState(!1),[d,n]=h.useState(null),[c,m]=h.useState(null),[l,x]=h.useState(!1);h.useEffect(()=>{r(!0),(async()=>{try{const{data:p}=await P();if(i(p),p&&p.result.length>0){const j=p.result[0]._id;m(j),await _(j)}}catch{C.error("Oops, something went wrong! Please try again later",{position:"top-right",autoClose:2e3})}finally{r(!1)}})()},[]),h.useEffect(()=>{c&&_(c)},[c]);const _=async o=>{try{const p=await T(o);n(es(p.dishes,o));const w=(JSON.parse(localStorage.getItem("dishes"))||[]).some(q=>q.shopId!==o);x(w)}catch(p){console.log(p.message)}finally{r(!1)}},u=o=>{m(o)};return s.jsxs("main",{className:S.page_container,children:[a?s.jsx(L,{}):s.jsxs(s.Fragment,{children:[!a&&!t&&s.jsx(v,{}),t&&s.jsx("h2",{className:S.shopPage_title,children:"Choose what you want to eat "}),s.jsxs("div",{className:S.content_wrapper,children:[t&&s.jsx(R,{shops:t.result,handleClick:u,selectedShopId:c,isDisabled:l}),t&&d&&s.jsx(k,{dishes:d,selectedShopId:c,isDisabled:l})]})]}),s.jsx($,{})]})});os.displayName="ShopPage";export{os as ShopPage,os as default};
